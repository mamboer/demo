 /**
 * 新浪数据采集
 * @fileoverview suda_log统计
 * @author wangfeng@staff.sina.com.cn
 * @date 2015-01-28
 */
(function(){function e(f){if(typeof window.onload=="function"){var g=window.onload;window.onload=function(){g();f()}}else{window.onload=f}}var a="",d=new Date().getTime();function c(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",function(){a=new Date().getTime();document.removeEventListener("DOMContentLoaded",arguments.callee,false)},false)}else{if(document.getElementById){document.write('<script id="ie-domReady" defer=\'defer\'src="//:"><\/script>');document.getElementById("ie-domReady").onreadystatechange=function(){if(this.readyState==="complete"){a=new Date().getTime();this.onreadystatechange=null;this.parentNode.removeChild(this)}}}}}c();function b(v){var ac=window,q=document,F=navigator,ab=F.userAgent,s=ac.screen,w=ac.location.href;var aa="https:"==ac.location.protocol?"https://":"http://",B="beacon.sina.com.cn";var t=aa+B+"/a.gif?",k=aa+B+"/e.gif?";var o="",af="";startTime="",readyTime="";currTime=parseInt(new Date().getTime());var h="",A=w.split("?")[1];if(!!A&&w.indexOf("wm=")>0){var j=A.split("&"),H=j.length;for(var ah=0;ah<H;ah++){var O=j[ah].split("=");if(O[0]=="wm"&&O[1]!="#column"){h=O[1];break}}}if(h){var m=n("wm");if(h!=m){x("wm",h,"","sina.cn")}}h=n("wm");if(typeof sudaLogConfig!=="undefined"){o=sudaLogConfig.uId!==undefined?sudaLogConfig.uId:"";af=sudaLogConfig.url!==undefined?sudaLogConfig.url:"";if(typeof globalConfig!=="undefined"){startTime=globalConfig.startTime!==undefined?globalConfig.startTime:d}}o=o||v||"";onloadTime=currTime-startTime;readyTime=a-startTime;var K="MT=";K+="wm:"+h;if(typeof sudaLogConfig!=="undefined"&&typeof sudaLogConfig.prevPageClickTime!=="undefined"&&sudaLogConfig.prevPageClickTime!==""){var X=sudaLogConfig.prevPageClickTime!==undefined?sudaLogConfig.prevPageClickTime:0,U=startTime-X;K+="|mperform:1|starttime:"+X+"|endtime:"+startTime+"|clicktime:"+U}var T=q.referrer.toLowerCase();var I="SINAGLOBAL",g="Apache",ae="ULV",r="SUP";var ad="";var M="",L="";var p=[],Y=[];var ak=0,al=0;function V(an,D){var am=q.getElementsByName(an);var i=(D>0)?D:0;return(am.length>i)?am[i].content:""}function z(){var ap=q.getElementsByName("sudameta");var aq=[];for(var D=0;D<ap.length;D++){var ao=ap[D].content;if(ao){if(ao.indexOf(";")!=-1){var ar=ao.split(";");for(var an=0;an<ar.length;an++){var am=f(ar[an]);if(!am){continue}aq.push(am)}}else{aq.push(ao)}}}return aq}function ag(ap,D,an,am){if(ap==""){return""}am=(am=="")?"=":am;D+=am;var ao=ap.indexOf(D);if(ao<0){return""}ao+=D.length;var i=ap.indexOf(an,ao);if(i<ao){i=ap.length}return ap.substring(ao,i)}function n(i){if(undefined==i||""==i){return""}return ag(q.cookie,i,";","")}function x(ao,i,D,an){if(i!=null){if((undefined==an)||(null==an)){an="sina.cn"}if((undefined==D)||(null==D)||(""==D)){q.cookie=ao+"="+i+";domain="+an+";path=/"}else{var am=new Date();var ap=am.getTime();ap=ap+86400000*D;am.setTime(ap);ap=am.getTime();q.cookie=ao+"="+i+";domain="+an+";expires="+am.toUTCString()+";path=/"}}}function u(i,an,am){var D=i;if(D==null){return false}an=an||"click";if((typeof am).toLowerCase()!="function"){return}if(D.attachEvent){D.attachEvent("on"+an,am)}else{if(D.addEventListener){D.addEventListener(an,am,false)}else{D["on"+an]=am}}return true}function aj(){if(window.event!=null){return window.event}else{if(window.event){return window.event}var D=arguments.callee.caller;var i;var am=0;while(D!=null&&am<40){i=D.arguments[0];if(i&&(i.constructor==Event||i.constructor==MouseEvent||i.constructor==KeyboardEvent)){return i}am++;D=D.caller}return i}}function ai(i){i=i||aj();if(!i.target){i.target=i.srcElement;i.pageX=i.x;i.pageY=i.y}if(typeof i.layerX=="undefined"){i.layerX=i.offsetX}if(typeof i.layerY=="undefined"){i.layerY=i.offsetY}return i}function f(an){if(typeof an!=="string"){throw"trim need a string as parameter"}var i=an.length;var am=0;var D=/(\u3000|\s|\t|\u00A0)/;while(am<i){if(!D.test(an.charAt(am))){break}am+=1}while(i>am){if(!D.test(an.charAt(i-1))){break}i-=1}return an.slice(am,i)}function N(i){return Object.prototype.toString.call(i)==="[object Array]"}function R(an,ar){var au=f(an).split("&");var at={};var am=function(i){if(ar){return decodeURIComponent(i)}else{return i}};for(var ap=0,aq=au.length;ap<aq;ap++){if(au[ap]){var ao=au[ap].split("=");var D=ao[0];var av=ao[1];if(ao.length<2){av=D;D="$nullName"}if(!at[D]){at[D]=am(av)}else{if(N(at[D])!=true){at[D]=[at[D]]}at[D].push(am(av))}}}return at}function S(D){var i=new RegExp("^http(?:s)?://([^/]+)","im");if(D.match(i)){return D.match(i)[1].toString()}else{return""}}var E={screenSize:function(){return s.width+"x"+s.height},colorDepth:function(){return s.colorDepth||""},appCode:function(){return F.appCodeName||""},appName:function(){return(F.appName.indexOf("Microsoft Internet Explorer")>-1)?"MSIE":F.appName},cpu:function(){return F.cpuClass||F.oscpu||""},platform:function(){return F.platform||""},jsVer:function(){var ao,i,aq,am=1,an=0,D=(F.appName.indexOf("Microsoft Internet Explorer")>-1)?"MSIE":F.appName,ap=F.appVersion;if("MSIE"==D){i="MSIE";ao=ap.indexOf(i);if(ao>=0){aq=window.parseInt(ap.substring(ao+5));if(3<=aq){am=1.1;if(4<=aq){am=1.3}}}}else{if(("Netscape"==D)||("Opera"==D)||("Mozilla"==D)){am=1.3;i="Netscape6";ao=ap.indexOf(i);if(ao>=0){am=1.5}}}return am},network:function(){var i="";i=(F.connection&&F.connection.type)?F.connection.type:i;try{q.body.addBehavior("#default#clientCaps");i=q.body.connectionType}catch(D){i="unkown"}return i},language:function(){return F.systemLanguage||F.language||""},timezone:function(){return new Date().getTimezoneOffset()/60||""},flashVer:function(){return""},javaEnabled:function(){var am=F.plugins,D=F.javaEnabled(),an,ao;if(D==true){return 1}if(am&&am.length){for(var i in am){an=am[i];if(an.description==null){continue}if(D!=null){break}ao=an.description.toLowerCase();if(ao.indexOf("java plug-in")!=-1){D=parseInt(an.version);continue}}}else{if(window.ActiveXObject){D=(new ActiveXObject("JavaWebStart.IsInstalled")!=null)}}return D?1:0}};var l={pageId:function(){return""},sessionCount:function(){return""},excuteCount:function(){return SUDA.sudaCount},referrer:function(){var i=/^[^\?&#]*.swf([\?#])?/;if((T=="")||(T.match(i))){var D=ag(w,"ref","&","");if(D!=""){return escape(D)}}return escape(T)},isHomepage:function(){var D="";try{q.body.addBehavior("#default#homePage");D=q.body.isHomePage(w)?"Y":"N"}catch(i){D="unkown"}return D},PGLS:function(){return V("stencil")||""},ZT:function(){var i=V("subjectid");i.replace(",",".");i.replace(";",",");return escape(i)},mediaType:function(){return V("mediaid")||""},domCount:function(){return q.getElementsByTagName("*").length||""},iframeCount:function(){return q.getElementsByTagName("iframe").length},onloadTime:onloadTime,readyTime:readyTime,webUrl:af};var Q={visitorId:function(){if(""!=I){var i=n(I);if(""==i){i=n(g);var D=3650;x(I,i,D)}return i}else{return""}},sessionId:function(){var i=n(g);if(i==""){var D=new Date();i=Math.random()*10000000000000+"."+D.getTime();x(g,i)}return i},flashCookie:function(i){return""},lastVisit:function(){var am=n(g);var ao=n(ae);var an=ao.split(":");var ap="",D;if(an.length>=6){if(am!=an[4]){D=new Date();var i=new Date(window.parseInt(an[0]));an[1]=window.parseInt(an[1])+1;if(D.getMonth()!=i.getMonth()){an[2]=1}else{an[2]=window.parseInt(an[2])+1}if(((D.getTime()-i.getTime())/86400000)>=7){an[3]=1}else{if(D.getDay()<i.getDay()){an[3]=1}else{an[3]=window.parseInt(an[3])+1}}ap=an[0]+":"+an[1]+":"+an[2]+":"+an[3];an[5]=an[0];an[0]=D.getTime();x(ae,an[0]+":"+an[1]+":"+an[2]+":"+an[3]+":"+am+":"+an[5],360)}else{ap=an[5]+":"+an[1]+":"+an[2]+":"+an[3]}}else{D=new Date();ap=":1:1:1";x(ae,D.getTime()+ap+":"+am+":",360)}return ap},userNick:function(){if(ad!=""){return ad}var am=unescape(n(r)),D="",i="",ao=o,ap="",an="";if(am!=""){D=ag(am,"ag","&","");i=ag(am,"user","&","");o=ag(am,"uid","&","");ap=ag(am,"sex","&","");an=ag(am,"dob","&","")}ad=D+":"+i+":"+ao+":"+ap+":"+an;return ad},userOrigin:function(){return""},advCount:function(){return""},subp:function(){return n("SUBP")}};var y={CI:function(){var i=["sz:"+E.screenSize(),"dp:"+E.colorDepth(),"ac:"+E.appCode(),"an:"+E.appName(),"cpu:"+E.cpu(),"pf:"+E.platform(),"jv:"+E.jsVer(),"ct:"+E.network(),"lg:"+E.language(),"tz:"+E.timezone(),"fv:"+E.flashVer(),"ja:"+E.javaEnabled()];return"CI="+i.join("|")},PI:function(D){var am=l.webUrl;if(!!D){am=escape(D)}var i=["pid:"+l.pageId(),"st:"+l.sessionCount(),"et:"+l.excuteCount(),"ref:"+l.referrer(),"hp:"+l.isHomepage(),"PGLS:"+l.PGLS(),"ZT:"+l.ZT(),"MT:"+l.mediaType(),"keys:","dom:"+l.domCount(),"ifr:"+l.iframeCount(),"nld:"+l.onloadTime,"drd:"+l.readyTime,"url:"+am];return"PI="+i.join("|")},UI:function(){var i=["vid:"+Q.visitorId(),"sid:"+Q.sessionId(),"lv:"+Q.lastVisit(),"un:"+Q.userNick(),"uo:"+Q.userOrigin(),"ae:"+Q.advCount(),"su:"+Q.subp(),"lu:","si:","rs:"+0,"dm:"+0];return"UI="+i.join("|")},EX:function(D,i){D=(null!=D)?D||"":M;i=(null!=i)?i||"":L;return"EX=ex1:"+D+"|ex2:"+i},MT:function(){return K},V:function(){return"V=2.3.1"},R:function(){return"gUid_"+new Date().getTime()}};function Z(i){G(i)}function G(D){var i=new Image();SUDA.img=i;i.src=D}function C(am,D,an){SUDA.sudaCount++;var i=t+[y.V(),y.CI(),y.PI(an),y.UI(),y.MT(),y.EX(am,D),y.R()].join("&");G(i)}function W(D,i,am){if(SUDA.sudaCount!=0){return}C(D,i,am)}function P(ao,i,D){if(!D){D=""}else{D=escape(D)}var an="UATrack||"+n(I)+"||"+n(g)+"||"+Q.userNick()+"||"+ao+"||"+i+"||"+l.referrer()+"||"+D+"||";var am=k+an+"&gUid_"+new Date().getTime();Z(am)}function J(ao){var i=ai(ao);var am=i.target;var ap="",D="";var an;if(am!=null&&am.getAttribute&&(!am.getAttribute("suda-uatrack")&&!am.getAttribute("suda-data"))){while(am!=null&&am.getAttribute&&(!!am.getAttribute("suda-uatrack")||!!am.getAttribute("suda-data"))==false){if(am==q.body){return}am=am.parentNode}}if(am==null||am.getAttribute==null){return}ap=am.getAttribute("suda-uatrack")||am.getAttribute("suda-data")||"";if(ap){an=R(ap);if(am.tagName.toLowerCase()=="a"){D=am.href}an.key&&SUDA.uaTrack&&SUDA.uaTrack(an.key,an.value||an.key,D)}}window.SUDA=window.SUDA||[];SUDA.sudaCount=SUDA.sudaCount||0;SUDA.log=function(){C.apply(null,arguments)};SUDA.uaTrack=function(){P.apply(null,arguments)};u(q.body,"click",J);W()}e(function(){if(typeof window.getUserInfo==="function"){window.getUserInfo(function(f){if(f&&f.uid){b(f.uid)}else{b()}},true)}else{b()}})})();