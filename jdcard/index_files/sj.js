!function(){"use strict";function n(n){n=n?n:{},this.channelUrl=n.channelUrl||location.protocol+"//"+location.hostname+"/?vt=4&urlHistory="+this.channelName(),this.startTime=0,this.endTime=0,this.init()}n.prototype={constructor:n,init:function(){this.goReturnChannel()},goReturnChannel:function(){if(this.startTime=Date.parse(new Date),this.HasHistoryUrl()){var n=this.channelUrl,t=location.href;history.replaceState(null,"",n),history.pushState("","",t),window.addEventListener("popstate",function(){this.endTime=Date.parse(new Date),this.endTime-this.startTime>500&&(this.suds_count(),setTimeout(function(){location.href=n},200))}.bind(this))}},HasHistoryUrl:function(){return history.pushState&&!t.Utils.isSinaNews()&&!t.Utils.isQQ()&&!t.Utils.isWeibo()&&this.isChannel()&&this.isOldAdd()&&this.isWm()&&this.isHomePage()},suds_count:function(){var n=this.channelName();window.suds_count&&window.suds_count({type:"sudsHistory",name:n,title:"回退拦截",index:0})},getUrlString:function(n){var t=location.href,i="(?:\\?|&){1}"+n+"=([^&]*)",e=new RegExp(i,"gi");return e.exec(t),RegExp.$1},channelName:function(){var n=location.hostname;return n.split(".")[0]},isChannel:function(){return-1==document.referrer.indexOf(this.channelName())},isOldAdd:function(){return-1==document.referrer.indexOf("urlHistory="+this.channelName())},isWm:function(){return 3206!=this.getUrlString("wm")},isHomePage:function(){return-1==document.referrer.indexOf("sina.cn")}};var t={};t.Utils={_UA:navigator.userAgent.toLowerCase(),UAIdentify:{weibo:"weibo",qq:"qq/",sinanews:"sinanews"},isInclude:function(n,t){return n.indexOf(t)>-1},isSinaNews:function(){var n=this.UAIdentify,t=this.isInclude(this._UA,n.sinanews);return t?!0:!1},isWeibo:function(){var n=this.UAIdentify,t=this.isInclude(this._UA,n.weibo);return t?!0:!1},isQQ:function(){var n=this.UAIdentify,t=this.isInclude(this._UA,n.qq);return t?!0:!1}},window.addEventListener("load",function(){new n})}(window,document);